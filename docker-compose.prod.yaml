version: "3.7"

services:
  kube-cluster:
    image: jkostov/kube-cluster
    container_name: prod-kube-cluster
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - APP_PORT=3000
      - KAFKA_URL=kube-kafka:9092
      - MONGO_URL=mongodb://root:root1234@kube-cluster-mongo:27017/database
    depends_on:
      - kube-cluster-mongo
      - kube-kafka

  kube-cluster-mongo:
    image: jkostov/mongo:4.2
    container_name: prod-kube-cluster-mongo
    expose:
      - "27017"
    volumes:
      - kube-cluster-mongo-data:/data/db
    environment:
      - MONGO_INITDB_ROOT_USERNAME=root
      - MONGO_INITDB_ROOT_PASSWORD=root1234
      - MONGO_INITDB_DATABASE=database

  kube-resource:
    image: jkostov/kube-resource
    container_name: prod-kube-resource
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=development
      - APP_PORT=3001
      - KAFKA_URL=kube-kafka:9092
      - MONGO_URL=mongodb://root:root1234@kube-resource-mongo:27017/database
    depends_on:
      - kube-resource-mongo
      - kube-kafka

  kube-resource-mongo:
    image: jkostov/mongo:4.2
    container_name: prod-kube-resource-mongo
    expose:
      - "27017"
    volumes:
      - kube-resource-mongo-data:/data/db
    environment:
      - MONGO_INITDB_ROOT_USERNAME=root
      - MONGO_INITDB_ROOT_PASSWORD=root1234
      - MONGO_INITDB_DATABASE=database

  kube-frontend:
    image: jkostov/kube-frontend
    container_name: prod-kube-frontend
    ports:
      - "80:80"
    environment:
      - NODE_ENV=development

  kube-zookeeper:
    image: wurstmeister/zookeeper:3.4.6
    container_name: prod-kube-zookeeper
    ports:
      - "2181:2181"

  kube-kafka:
    image: wurstmeister/kafka:2.12-2.4.0
    container_name: prod-kube-kafka
    expose:
      - "9092"
    environment:
      KAFKA_ZOOKEEPER_CONNECT: kube-zookeeper:2181
      KAFKA_ADVERTISED_HOST_NAME: kube-kafka

volumes:
  kube-cluster-mongo-data: {}
  kube-resource-mongo-data: {}
